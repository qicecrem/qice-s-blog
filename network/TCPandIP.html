<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TCP/IP</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.25.0/themes/prism.min.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.25.0/prism.min.js"></script>
    <style>
        /* 自定义样式可以在这里添加 */
        pre {
            background-color: #f4f4f4;
            padding: 10px;
            border: 1px solid #ccc;
            overflow: auto;
        }

        code {
            font-family: monospace;
        }
    </style>
</head>

<body>
    <img src="picture\24-06-02_14-54-59.png" alt="TCP/IP协议栈" width="100%">

<p>1.1.1数据链路层<br>
    数据链路层实现了网卡接口的网络驱动程序，以处理数据在物理媒介上的传输。<br>
    总的来说：数据链路层在TCP/IP协议栈中的主要作用是确保数据帧在物理网络上的可靠传输。它通过帧封装、物理地址寻址、差错检测、流量控制、介质访问控制、链路管理和帧排序等机制，提供了一种在物理层基础上的可靠传输方式。<br>
</p>
<p>1.1.2网络层<br>
网络层实现数据包的选路和转发。<br>选择中间节点，确定两台主机之间的通行路径。
</p>
<p>1.1.3传输层<br>为两台主机上的应用程序提供端到端的通信。<br>
    <img src="picture\24-06-02_15-23-20.png"  width="100%">
由图可知数据链路层封装了物理网络的电气细节；<br>
网络层封装了网络连接的细节；<br>
传输层为应用封装了一条端到端的逻辑通信链路。<br>
传输协议主要有三个：TCP、UDP、SCTP。<br>
TCP：为应用层提供可靠的，面向连接的和基于流的服务。<br>
UDP：为应用层提供不可靠的，无连接的和基于数据报的服务。<br>
SCTP：为应用层提供可靠的，面向连接的和基于消息的服务。为因特网上传输电话信号而设计<br>


</p>
<p>1.1.4应用层<br>
应用层负责处理应用程序的逻辑。数据链路层，网络层和传输层在内核空间中实现，而应用层在用户空间实现，应为他负责处理众多逻辑，比如文件查询，网络管理等。<br>

</p>
<p>1.2封装<br>
应用程序数据再发送到物理网络之前，必须经过多层协议的封装。封装的过程是将上一层的数据添加一个头部，这个头部包含了一些控制信息，然后再将这个头部和上一层的数据一起传递给下一层。这样，数据就被封装在一个新的数据包中，这个数据包就可以在网络上传输了。<br>
<img src="picture\24-06-02_15-58-30.png"  width="100%">
经TCP封装的数据称为TCP报文段，经UDP封装的数据称为UDP数据报，经IP封装的数据称为IP数据报，经以太网封装的数据称为以太网帧。<br>
<img src="picture\24-06-02_16-08-47.png"  width="100%">
<img src="picture\24-06-02_16-08-58.png"  width="100%">

</p>
<p>1.3分用<br>
当帧到达目的主机时，它会被逐层解封装，直到到达应用层。这个过程称为分用。分用的过程是封装的逆过程，它将每一层的头部信息去掉，然后将数据传递给上一层。<br>
<img src="picture\24-06-02_16-15-03.png"  width="100%">
</p>
<p>1.4 ARP协议<br>
ARP协议能实现任意网络层地址到任意物理层地址的转换。<br>
工作原理：当主机A要发送数据给主机B时，它首先会检查自己的ARP缓存，如果找到了主机B的IP地址对应的物理地址，就直接将数据帧发送给主机B。如果没有找到，主机A就会发送一个ARP请求广播，请求主机B回复自己的物理地址。主机B收到ARP请求后，就会回复自己的物理地址，主机A收到回复后，就会将数据帧发送给主机B。<br>
1.5.1ARP请求/应答报文<br>
<img src="picture\24-06-02_16-27-23.png"  width="100%">
硬件类型字段定义物理地址的类型，他的值为1表示MAC地址；<br>
协议类型字段表示要映射的协议地址类型，他的值为0x800,表示IP地址<br>
硬件地址长度字段表示物理地址的长度，他的值为6，表示MAC地址的长度为6个字节。<br>
协议地址长度字段表示协议地址的长度，他的值为4，表示IP地址的长度为4个字节。<br>
操作码字段指出4种操作类型：ARP请求（值为1），ARP应答（值为2），RARP请求（值为3），RARP应答（值为4）。<br>
最后4个字段指定通信双方的以太网地址和IP地址。<br>
</p>
<p>1.5.2ARP高速缓存的查看和修改<br>
    arp -a命令可以查看ARP高速缓存<br>
    <img src="picture\24-06-02_16-48-11.png"  width="100%">
    <img src="picture\24-06-02_16-48-34.png"  width="100%">
    第一项描述测试机名，IP地址，物理地址。第二项描述路由器.<br>
    arp -d命令可以删除ARP高速缓存中的条目<br>
    arp -s命令可以添加一条静态ARP高速缓存条目<br>
    <img src="picture\24-06-02_16-49-10.png"  width="100%">

</p>
<p>1.6.1 DNS查询和应答报文详解<br>
每个DNS服务器上都存放大量的机器名和IP地址的映射。<br>
<img src="picture\24-06-02_21-11-30.png"  width="100%">
16位标识字段用于标记一对DNS查询和应答，以此区分一个DNS应答是哪个DNS查询的回应。<br>
16为标志字段用于协商具体的通信方式和反馈通信状态。<br>
<img src="picture\24-06-02_21-19-02.png"  width="100%"><br>
QR字段用于区分查询报文和应答报文，值为0表示查询报文，值为1表示应答报文。<br>
opcode,定义查询和应答的类型，0表示标准查询，1表示反向查询（由IP地址获得主机域名），2表示服务器状态请求。<br>
AA字段表示授权回答，值为1表示DNS服务器是权威服务器，值为0表示DNS服务器不是权威服务器。<br>
TC字段表示截断，仅当DNS报文使用UDP服务是使用值为1表示DNS报文超过了512字节，被截断。<br>
RD，递归查询标志。1表示执行递归查询，即如果目标DNS服务器无法解析某个主机名，则它将向其他DNS服务器继续查询，
如此递归，直到获得结果并将该结果返回给客户端。<br>0表示执行迭代查询，即如果目标DNS服务器无法解析某个主机名，则它将自己知道的其他DNS服务器的IP地址返回给客户端，以供客户端参考。<br>
RA字段表示递归查询可用，值为1表示目标DNS服务器支持递归查询，值为0表示目标DNS服务器不支持递归查询。<br>
zero，这三位字段保留，必须都设置为0。<br>
rcode，返回码，用于指出DNS查询的状态，值为0表示没有错误，值为3表示名字错误，值为2表示服务器错误。<br><br>
<img src="picture\24-06-03_12-47-06.png"  width="100%"><br>
查询名以一定的格式封装了要查询的主机域名。16位查询类型表示如何执行查询操作，常见的类型有：<br>
类型A，值为1，表示获取目标主机的IP地址。<br>
类型CNAME，值为5，表示获取目标主机的别名。<br>
类型PTR，值为12，表示反向查询。<br>
16位查询类通常为1，表示获取英特网地址（IP地址）<br>
<br>
应答字段，授权字段和额外信息字段都使用资源记录格式。<br>
<img src="picture\24-06-03_13-00-42.png"  width="100%"><br>
32位域名是该记录中与资源对应的名字，其格式和查询问题中的查询名字段相同。<br>
16位类型和16位类字段的含义也与DNS查询问题的对应字段相同。<br>
32位生存时间表示改查询记录结果与可被本地客户端程序缓存多长时间，单位为秒。<br>
16位资源数据长度字段和资源数据字段的内容取决于类型字段。对于类型A而言，资源数据是32位的IPv4地址，而资源数据长度则为4字节。























</p>







</body>

</html>